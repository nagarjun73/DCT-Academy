<!DOCTYPE html>
<html>

<head>
  <title></title>
</head>

<body>
  <div id="root">

  </div>

  <script src="../JS/react.development.js"></script>
  <script src="../JS/react-dom.development.js"></script>
  <script src="../JS/babel-standalone@6.26.0_babel.js"></script>

  <script type="text/babel">
    const rootHandle = document.getElementById("root");
    const { useState, useEffect } = React

    function NoteForm(props) {
      const [input, setInput] = useState('')
      const [categ, setCateg] = useState('')
      const { addNote, notes } = props

      useEffect(() => {
        setInput('')
      }, [notes])

      function onSubmitHandle(e) {
        e.preventDefault()
        const categg = categ.split(',').map((ele) => { return ele.trim().toLowerCase() })
        console.log(categg);
        const newObj = {
          id: Number(new Date()),
          body: input,
          createdAt: new Date(),
          categories: categg
        }
        addNote(newObj)
      }

      function inputHandle(e) {
        const val = e.target.value
        setInput(val)
      }

      return (
        <form onSubmit={onSubmitHandle}>
          <textarea type="text" value={input} onChange={inputHandle} /> <br />
          <input type="text" value={categ} onChange={(e) => setCateg(e.target.value)} />
          <input type="submit" value="Create Note" />
        </form>
      )
    }

    function NoteList(props) {
      const { notes, deleteNote, editNotes } = props
      const [categories, setCategories] = useState([])
      const [selected, setSelected] = useState('')

      useEffect(() => {
        const note = [...notes]
        const newCateg = []
        for (let i = 0; i < note.length; i++) {
          for (let j = 0; j < note[i].categories.length; j++) {
            if (!newCateg.includes(note[i].categories[j])) {
              newCateg.push(note[i].categories[j])
            }
          }
        }
        setCategories(newCateg)
      }, [notes])

      function categoryClickHandle(category) {
        setSelected(category)
      }

      function renderSelected() {
        const filterdArr = notes.filter((ele) => ele.categories.includes(selected))
        if (filterdArr.length !== 0) {
          return filterdArr
        } else {
          return notes
        }
      }

      return (
        <div>
          <h3>Categories</h3>
          <div>
            {categories.map((cat, i) => {
              return (<span key={i} style={{ marginRight: '10px' }}><a href='#' onClick={() => categoryClickHandle(cat)}>{cat}</a></span>)
            })}
          </div>
          <h2>Listing Notes - {notes.length}</h2>
          {renderSelected().map((note, i) => {
            return (
              <NoteItem key={i} note={note} deleteNote={deleteNote} editNotes={editNotes} />
            )
          })}
        </div>
      )
    }

    function NoteItem(props) {
      const { note, deleteNote, editNotes } = props
      const [toggle, setToggle] = useState(false)
      const [inputEdit, setInputEdit] = useState('')

      function deleteHandle() {
        deleteNote(note.id)
      }

      function editSubmithandle(e) {
        e.preventDefault()
        const newObj = {
          id: note.id,
          body: inputEdit,
          createdAt: note.createdAt,
          categories: note.categories
        }
        editNotes(newObj)
        setToggle(!toggle)
      }

      useEffect(() => {
        setInputEdit(note.body)
      }, [])


      return (
        <div>
          {!toggle ?
            (<div>
              <blockquote>{note.body}</blockquote>
              <p>created on {new Date(note.createdAt).toLocaleString()}</p>
              <p># - {note.categories.toString()}</p>
            </div>) : (
              <form onSubmit={editSubmithandle}>
                <input type="text" value={inputEdit} onChange={(e) => setInputEdit(e.target.value)} />
                <input type="submit" />
              </form>
            )
          }
          {!toggle && <button onClick={() => setToggle(!toggle)}>Edit</button>}
          <button onClick={deleteHandle}>Delete</button>
          <hr />
        </div>
      )
    }

    function App(props) {
      const [notes, setNotes] = useState([])

      useEffect(() => {
        const data = localStorage.getItem('notes')
        if (data) {
          setNotes(JSON.parse(data))
        }
      }, [])

      useEffect(() => {
        localStorage.setItem('notes', JSON.stringify(notes))
      }, [notes])

      function addNote(newObj) {
        const updateNote = [newObj, ...notes]
        setNotes(updateNote)
      }

      function deleteNote(ide) {
        const deleteNote = notes.filter((note) => {
          if (note.id !== ide) {
            return note
          }
        })
        setNotes(deleteNote)
      }

      function editNotes(obj) {
        const editedArr = notes.map((ele) => {
          if (ele.id == obj.id) {
            return obj
          } else {
            return ele
          }
        })
        console.log(editedArr);
        setNotes(editedArr)
      }

      return (
        <div>
          <h1>Note-Taking App</h1>
          <NoteForm addNote={addNote} notes={notes} />
          {notes.length ? <NoteList notes={notes} deleteNote={deleteNote} editNotes={editNotes} /> : 'No notes Found'}
        </div>
      )
    }

    ReactDOM.render(<App />, rootHandle)
  </script>
</body>

</html>